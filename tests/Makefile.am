RNG=$(top_srcdir)/data/xml/interface.rng

GNULIB= ../gnulib/lib/libgnu.la
GNULIB_CFLAGS= -I $(top_srcdir)/gnulib/lib

AM_CFLAGS = $(NETCF_CFLAGS) $(WARN_CFLAGS) $(GNULIB_CFLAGS) \
	$(LIBXML_CFLAGS) -I $(top_builddir)/src

EXTRA_DIST = interface initscripts root

TESTS_ENVIRONMENT = \
  PATH='$(abs_top_builddir)/src$(PATH_SEPARATOR)'"$$PATH" \
  NETCF_DATADIR='$(abs_top_srcdir)/data' \
  abs_top_builddir='$(abs_top_builddir)' \
  abs_top_srcdir='$(abs_top_srcdir)'

TESTS=test-initscripts

INCLUDES = -I$(top_srcdir)/src

# FIXME: Needs to be conditionalized
check_PROGRAMS=test-initscripts

test_initscripts_SOURCES = test-initscripts.c cutest.c cutest.h tutil.c tutil.h
test_initscripts_LDADD = $(top_builddir)/src/libnetcf.la $(GNULIB)

# Clean up files generated by test-initscripts
distclean-local:
	@chmod -R u+w $(top_builddir)/build/test_initscripts
	@rm -rf $(top_builddir)/build/test_initscripts

xmllint:
	@(for f in interface/*.xml; do                       \
	    if [ $$(basename $$f) != "schemas.xml" ] ; then  \
	      xmllint -relaxng $(RNG) -noout $$f             \
	        || echo FAIL;                                \
            fi;                                              \
	  done)
